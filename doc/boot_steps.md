# RabbitBootSteps流程

* 模块 `rabbit_boot_steps.erl`
* 执行命令获取启动关系图 `rabbit_boot_steps:find_steps().`

```erlang
(rabbit@admindeMacBook-Pro)1> rp(rabbit_boot_steps:find_steps()).
[{rabbit,pre_boot,[{description,"rabbit boot start"}]},
 {rabbit,rabbit_core_metrics,
     [{description,"core metrics storage"},
      {mfa,{rabbit_sup,start_child,[rabbit_metrics]}},
      {requires,pre_boot},
      {enables,external_infrastructure}]},
 {rabbit,rabbit_alarm,
     [{description,"alarm handler"},
      {mfa,{rabbit_alarm,start,[]}},
      {requires,pre_boot},
      {enables,external_infrastructure}]},
 {rabbit,code_server_cache,
     [{description,"code_server cache server"},
      {mfa,{rabbit_sup,start_child,[code_server_cache]}},
      {requires,rabbit_alarm},
      {enables,file_handle_cache}]},
 {rabbit,file_handle_cache,
     [{description,"file handle cache server"},
      {mfa,{rabbit,start_fhc,[]}},
      {requires,code_server_cache},
      {enables,worker_pool}]},
 {rabbit,worker_pool,
     [{description,"default worker pool"},
      {mfa,{rabbit_sup,start_supervisor_child,[worker_pool_sup]}},
      {requires,pre_boot},
      {enables,external_infrastructure}]},
 {rabbit,database,
     [{mfa,{rabbit_mnesia,init,[]}},
      {requires,file_handle_cache},
      {enables,external_infrastructure}]},
 {rabbit,database_sync,
     [{description,"database sync"},
      {mfa,{rabbit_sup,start_child,[mnesia_sync]}},
      {requires,database},
      {enables,external_infrastructure}]},
 {rabbit,feature_flags,
     [{description,"feature flags registry and initial state"},
      {mfa,{rabbit_feature_flags,init,[]}},
      {requires,pre_boot},
      {enables,external_infrastructure}]},
 {rabbit,codec_correctness_check,
     [{description,"codec correctness check"},
      {mfa,{rabbit_binary_generator,check_empty_frame_size,[]}},
      {requires,pre_boot},
      {enables,external_infrastructure}]},
 {rabbit,external_infrastructure,
     [{description,"external infrastructure ready"}]},
 {rabbit,rabbit_registry,
     [{description,"plugin registry"},
      {mfa,{rabbit_sup,start_child,[rabbit_registry]}},
      {requires,external_infrastructure},
      {enables,kernel_ready}]},
 {rabbit,rabbit_auth_mechanism_cr_demo,
     [{description,"auth mechanism cr-demo"},
      {mfa,
          {rabbit_registry,register,
              [auth_mechanism,<<"RABBIT-CR-DEMO">>,
               rabbit_auth_mechanism_cr_demo]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_queue_location_random,
     [{description,"locate queue master random"},
      {mfa,
          {rabbit_registry,register,
              [queue_master_locator,<<"random">>,
               rabbit_queue_location_random]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_event,
     [{description,"statistics event manager"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_event]}},
      {requires,external_infrastructure},
      {enables,kernel_ready}]},
 {rabbit,rabbit_auth_mechanism_amqplain,
     [{description,"auth mechanism amqplain"},
      {mfa,
          {rabbit_registry,register,
              [auth_mechanism,<<"AMQPLAIN">>,rabbit_auth_mechanism_amqplain]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_auth_mechanism_plain,
     [{description,"auth mechanism plain"},
      {mfa,
          {rabbit_registry,register,
              [auth_mechanism,<<"PLAIN">>,rabbit_auth_mechanism_plain]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_exchange_type_direct,
     [{description,"exchange type direct"},
      {mfa,
          {rabbit_registry,register,
              [exchange,<<"direct">>,rabbit_exchange_type_direct]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_exchange_type_fanout,
     [{description,"exchange type fanout"},
      {mfa,
          {rabbit_registry,register,
              [exchange,<<"fanout">>,rabbit_exchange_type_fanout]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_exchange_type_headers,
     [{description,"exchange type headers"},
      {mfa,
          {rabbit_registry,register,
              [exchange,<<"headers">>,rabbit_exchange_type_headers]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_exchange_type_topic,
     [{description,"exchange type topic"},
      {mfa,
          {rabbit_registry,register,
              [exchange,<<"topic">>,rabbit_exchange_type_topic]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_mirror_queue_mode_all,
     [{description,"mirror mode all"},
      {mfa,
          {rabbit_registry,register,
              [ha_mode,<<"all">>,rabbit_mirror_queue_mode_all]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_mirror_queue_mode_exactly,
     [{description,"mirror mode exactly"},
      {mfa,
          {rabbit_registry,register,
              [ha_mode,<<"exactly">>,rabbit_mirror_queue_mode_exactly]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_mirror_queue_mode_nodes,
     [{description,"mirror mode nodes"},
      {mfa,
          {rabbit_registry,register,
              [ha_mode,<<"nodes">>,rabbit_mirror_queue_mode_nodes]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_priority_queue,
     [{description,"enable priority queue"},
      {mfa,{rabbit_priority_queue,enable,[]}},
      {requires,pre_boot},
      {enables,kernel_ready}]},
 {rabbit,rabbit_queue_location_client_local,
     [{description,"locate queue master client local"},
      {mfa,
          {rabbit_registry,register,
              [queue_master_locator,<<"client-local">>,
               rabbit_queue_location_client_local]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,rabbit_queue_location_min_masters,
     [{description,"locate queue master min bound queues"},
      {mfa,
          {rabbit_registry,register,
              [queue_master_locator,<<"min-masters">>,
               rabbit_queue_location_min_masters]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbitmq_golden_exchange,rabbit_exchange_type_golden,
     [{description,
          "Exchange type to allow parse routing keys on items for a message"},
      {mfa,
          {rabbit_registry,register,
              [exchange,<<"x-golden">>,rabbit_exchange_type_golden]}},
      {requires,rabbit_registry},
      {enables,kernel_ready}]},
 {rabbit,kernel_ready,
     [{description,"kernel ready"},{requires,external_infrastructure}]},
 {rabbit,rabbit_sysmon_minder,
     [{description,"sysmon_handler supervisor"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_sysmon_minder]}},
      {requires,kernel_ready},
      {enables,core_initialized}]},
 {rabbit,rabbit_epmd_monitor,
     [{description,"epmd monitor"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_epmd_monitor]}},
      {requires,kernel_ready},
      {enables,core_initialized}]},
 {rabbit,guid_generator,
     [{description,"guid generator"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_guid]}},
      {requires,kernel_ready},
      {enables,core_initialized}]},
 {rabbit,rabbit_node_monitor,
     [{description,"node monitor"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_node_monitor]}},
      {requires,[rabbit_alarm,guid_generator]},
      {enables,core_initialized}]},
 {rabbit,delegate_sup,
     [{description,"cluster delegate"},
      {mfa,{rabbit,boot_delegate,[]}},
      {requires,kernel_ready},
      {enables,core_initialized}]},
 {rabbit,rabbit_memory_monitor,
     [{description,"memory monitor"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_memory_monitor]}},
      {requires,rabbit_alarm},
      {enables,core_initialized}]},
 {rabbit,core_initialized,
     [{description,"core initialized"},{requires,kernel_ready}]},
 {rabbit,upgrade_queues,
     [{description,"per-vhost message store migration"},
      {mfa,{rabbit_upgrade,maybe_migrate_queues_to_per_vhost_storage,[]}},
      {requires,[core_initialized]},
      {enables,recovery}]},
 {rabbit,channel_tracking,
     [{description,"channel tracking infrastructure"},
      {mfa,{rabbit_channel_tracking,boot,[]}},
      {enables,routing_ready}]},
 {rabbit,rabbit_channel_tracking_handler,
     [{description,"channel tracking event handler"},
      {mfa,
          {gen_event,add_handler,
              [rabbit_event,rabbit_channel_tracking_handler,[]]}},
      {cleanup,
          {gen_event,delete_handler,
              [rabbit_event,rabbit_channel_tracking_handler,[]]}},
      {requires,[channel_tracking]},
      {enables,recovery}]},
 {rabbit,connection_tracking,
     [{description,"connection tracking infrastructure"},
      {mfa,{rabbit_connection_tracking,boot,[]}},
      {enables,routing_ready}]},
 {rabbit,rabbit_connection_tracking_handler,
     [{description,"connection tracking event handler"},
      {mfa,
          {gen_event,add_handler,
              [rabbit_event,rabbit_connection_tracking_handler,[]]}},
      {cleanup,
          {gen_event,delete_handler,
              [rabbit_event,rabbit_connection_tracking_handler,[]]}},
      {requires,[connection_tracking]},
      {enables,recovery}]},
 {rabbit,rabbit_exchange_parameters,
     [{description,"exchange parameters"},
      {mfa,{rabbit_exchange_parameters,register,[]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbit,rabbit_mirror_queue_misc,
     [{description,"HA policy validation"},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-mode">>,rabbit_mirror_queue_misc]}},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-params">>,rabbit_mirror_queue_misc]}},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-sync-mode">>,rabbit_mirror_queue_misc]}},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-sync-batch-size">>,
               rabbit_mirror_queue_misc]}},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-promote-on-shutdown">>,
               rabbit_mirror_queue_misc]}},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"ha-promote-on-failure">>,
               rabbit_mirror_queue_misc]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbit,rabbit_policies,
     [{description,"internal policies"},
      {mfa,{rabbit_policies,register,[]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbit,rabbit_policy,
     [{description,"policy parameters"},
      {mfa,{rabbit_policy,register,[]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbit,rabbit_queue_location_validator,
     [{description,"Queue location policy validation"},
      {mfa,
          {rabbit_registry,register,
              [policy_validator,<<"queue-master-locator">>,
               rabbit_queue_location_validator]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbit,rabbit_quorum_memory_manager,
     [{description,"quorum memory manager"},
      {mfa,{rabbit_quorum_memory_manager,register,[]}},
      {cleanup,{rabbit_quorum_memory_manager,unregister,[]}},
      {requires,rabbit_event},
      {enables,recovery}]},
 {rabbit,rabbit_vhost_limit,
     [{description,"vhost limit parameters"},
      {mfa,{rabbit_vhost_limit,register,[]}},
      {requires,rabbit_registry},
      {enables,recovery}]},
 {rabbitmq_event_exchange,rabbit_event_exchange_decorator,
     [{description,"event exchange decorator"},
      {mfa,
          {rabbit_registry,register,
              [exchange_decorator,<<"event">>,
               rabbit_event_exchange_decorator]}},
      {requires,rabbit_registry},
      {cleanup,{rabbit_registry,unregister,[exchange_decorator,<<"event">>]}},
      {enables,recovery}]},
 {rabbitmq_management,rabbit_mgmt_reset_handler,
     [{description,"management extension handling"},
      {mfa,
          {gen_event,add_handler,[rabbit_event,rabbit_mgmt_reset_handler,[]]}},
      {cleanup,
          {gen_event,delete_handler,
              [rabbit_event,rabbit_mgmt_reset_handler,[]]}},
      {requires,rabbit_event},
      {enables,recovery}]},
 {rabbitmq_management_agent,rabbit_mgmt_db_handler,
     [{description,"management agent"},
      {mfa,{rabbit_mgmt_db_handler,add_handler,[]}},
      {cleanup,
          {gen_event,delete_handler,[rabbit_event,rabbit_mgmt_db_handler,[]]}},
      {requires,rabbit_event},
      {enables,recovery}]},
 {rabbit,recovery,
     [{description,"exchange, queue and binding recovery"},
      {mfa,{rabbit,recover,[]}},
      {requires,[core_initialized]},
      {enables,routing_ready}]},
 {rabbit,empty_db_check,
     [{description,"empty DB check"},
      {mfa,{rabbit,maybe_insert_default_data,[]}},
      {requires,recovery},
      {enables,routing_ready}]},
 {rabbit,rabbit_looking_glass,
     [{description,"Looking Glass tracer and profiler"},
      {mfa,{rabbit_looking_glass,boot,[]}},
      {requires,[core_initialized,recovery]},
      {enables,routing_ready}]},
 {rabbit,rabbit_core_metrics_gc,
     [{description,"background core metrics garbage collection"},
      {mfa,{rabbit_sup,start_restartable_child,[rabbit_core_metrics_gc]}},
      {requires,[core_initialized,recovery]},
      {enables,routing_ready}]},
 {rabbit,background_gc,
     [{description,"background garbage collection"},
      {mfa,{rabbit_sup,start_restartable_child,[background_gc]}},
      {requires,[core_initialized,recovery]},
      {enables,routing_ready}]},
 {rabbitmq_event_exchange,rabbit_event_exchange,
     [{description,"event exchange"},
      {mfa,{rabbit_exchange_type_event,register,[]}},
      {cleanup,{rabbit_exchange_type_event,unregister,[]}},
      {requires,recovery},
      {enables,routing_ready}]},
 {rabbit,routing_ready,
     [{description,"message delivery logic ready"},
      {requires,[core_initialized,recovery]}]},
 {rabbit,pre_flight,
     [{description,"ready to communicate with peers and clients"},
      {requires,[core_initialized,recovery,routing_ready]}]},
 {rabbit,notify_cluster,
     [{description,"notifies cluster peers of our presence"},
      {mfa,{rabbit_node_monitor,notify_node_up,[]}},
      {requires,pre_flight}]},
 {rabbit,networking,
     [{description,"TCP and TLS listeners (backwards compatibility)"},
      {mfa,
          {rabbit_log,debug,
              ["'networking' boot step skipped and moved to end of startup",
               []]}},
      {requires,notify_cluster}]},
 {rabbit,definition_import_worker_pool,
     [{description,"dedicated worker pool for definition import"},
      {mfa,{rabbit_definitions,boot,[]}},
      {requires,external_infrastructure}]},
 {rabbit,cluster_name,
     [{description,"sets cluster name if configured"},
      {mfa,{rabbit_nodes,boot,[]}},
      {requires,pre_flight}]},
 {rabbit,direct_client,
     [{description,"direct client"},
      {mfa,{rabbit_direct,boot,[]}},
      {requires,pre_flight}]},
 {rabbitmq_management,rabbit_management_load_definitions,
     [{description,"Imports definition file at management.load_definitions"},
      {mfa,{rabbit_mgmt_load_definitions,boot,[]}}]}]
```